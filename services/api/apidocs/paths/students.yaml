# Students, Academic Structure, Student 360, Custom Fields, Houses, Hostel, ID Cards, Promotion paths

/admin/students:
  get:
    operationId: listStudents
    tags: [Students]
    summary: List students with filtering and pagination
    description: |
      Returns a paginated list of students for the tenant. Supports searching
      by name/admission number and filtering by class/section.
    parameters:
      - name: limit
        in: query
        schema: { type: integer, default: 50, maximum: 200 }
        description: Maximum number of results to return
      - name: offset
        in: query
        schema: { type: integer, default: 0 }
        description: Number of results to skip (for pagination)
      - name: search
        in: query
        schema: { type: string }
        description: Search by student name or admission number
      - name: class_id
        in: query
        schema: { type: string, format: uuid }
        description: Filter by class ID
      - name: section_id
        in: query
        schema: { type: string, format: uuid }
        description: Filter by section ID
      - name: status
        in: query
        schema: { type: string, enum: [active, inactive, alumni] }
        description: Filter by student status
    responses:
      '200':
        description: Paginated student list
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id: { type: string, format: uuid }
                      admission_number: { type: string, example: "2025/001" }
                      first_name: { type: string }
                      last_name: { type: string }
                      class_name: { type: string, example: "Class 5" }
                      section_name: { type: string, example: "A" }
                      status: { type: string, enum: [active, inactive, alumni] }
                      photo_url: { type: string, format: uri }
                total: { type: integer, description: Total matching records }
  post:
    operationId: createStudent
    tags: [Students]
    summary: Create a new student
    description: |
      Creates a new student record. The student is assigned an admission number
      (auto-generated if not provided), linked to a class and section, and
      optionally populated with additional fields like date of birth and gender.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [first_name, last_name, class_id, section_id]
            properties:
              first_name: { type: string, example: "Ananya" }
              last_name: { type: string, example: "Verma" }
              admission_number: { type: string, description: Auto-generated if omitted }
              class_id: { type: string, format: uuid }
              section_id: { type: string, format: uuid }
              date_of_birth: { type: string, format: date, example: "2015-05-12" }
              gender: { type: string, enum: [male, female, other] }
              phone: { type: string }
              address: { type: string }
              photo_url: { type: string, format: uri }
    responses:
      '201':
        description: Student created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                id: { type: string, format: uuid }
                admission_number: { type: string }

/admin/students/{id}:
  get:
    operationId: getStudent
    tags: [Students]
    summary: Get student details
    description: Returns complete student profile including class, section, guardians, and custom fields.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
        description: Student ID
    responses:
      '200':
        description: Student detail
        content:
          application/json:
            schema:
              type: object
              properties:
                id: { type: string, format: uuid }
                admission_number: { type: string }
                first_name: { type: string }
                last_name: { type: string }
                date_of_birth: { type: string, format: date }
                gender: { type: string }
                class_id: { type: string, format: uuid }
                class_name: { type: string }
                section_id: { type: string, format: uuid }
                section_name: { type: string }
                status: { type: string }
                photo_url: { type: string }
                guardians: { type: array, items: { type: object } }
                custom_fields: { type: object, additionalProperties: true }
      '404':
        description: Student not found
  put:
    operationId: updateStudent
    tags: [Students]
    summary: Update student details
    description: Updates any editable fields on the student record. Partial updates are supported.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              first_name: { type: string }
              last_name: { type: string }
              class_id: { type: string, format: uuid }
              section_id: { type: string, format: uuid }
              date_of_birth: { type: string, format: date }
              gender: { type: string }
              status: { type: string, enum: [active, inactive] }
    responses:
      '200':
        description: Student updated
  delete:
    operationId: deleteStudent
    tags: [Students]
    summary: Delete (soft-delete) a student
    description: Marks the student as deleted. Data is retained for audit purposes.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Student deleted

/admin/students/{id}/guardians:
  get:
    operationId: listStudentGuardians
    tags: [Students]
    summary: List guardians for a student
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Guardian list
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  name: { type: string }
                  relation: { type: string, example: "Father" }
                  phone: { type: string }
                  email: { type: string, format: email }
                  is_primary: { type: boolean }
  post:
    operationId: addStudentGuardian
    tags: [Students]
    summary: Add a guardian to a student
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name, phone, relation]
            properties:
              name: { type: string }
              phone: { type: string }
              relation: { type: string, description: "Relationship to student", example: "Mother" }
              email: { type: string, format: email }
              is_primary: { type: boolean, default: false }
    responses:
      '201':
        description: Guardian added

/admin/students/import:
  post:
    operationId: importStudents
    tags: [Students]
    summary: Bulk import students from CSV/Excel
    description: |
      Accepts a CSV or Excel file with student data and creates records in bulk.
      Returns the import job ID for tracking progress. Duplicate admission
      numbers are reported as errors.
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required: [file]
            properties:
              file:
                type: string
                format: binary
                description: CSV or Excel file with student data
    responses:
      '200':
        description: Import job created
        content:
          application/json:
            schema:
              type: object
              properties:
                job_id: { type: string, format: uuid }
                total_rows: { type: integer }
                created: { type: integer }
                errors: { type: integer }

# ─── Academic Structure ──────────────────────────────
/admin/academic-structure/academic-years:
  get:
    operationId: listAcademicYears
    tags: [Academic Structure]
    summary: List academic years
    description: Returns all academic years configured for the tenant, ordered by start date.
    responses:
      '200':
        description: Academic year list
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  name: { type: string, example: "2025-26" }
                  start_date: { type: string, format: date }
                  end_date: { type: string, format: date }
                  is_current: { type: boolean }
  post:
    operationId: createAcademicYear
    tags: [Academic Structure]
    summary: Create a new academic year
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name, start_date, end_date]
            properties:
              name: { type: string, example: "2026-27" }
              start_date: { type: string, format: date }
              end_date: { type: string, format: date }
    responses:
      '201':
        description: Academic year created

/admin/academic-structure/classes:
  get:
    operationId: listClasses
    tags: [Academic Structure]
    summary: List all classes
    responses:
      '200':
        description: Class list with IDs and display order
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  name: { type: string, example: "Class 5" }
                  display_order: { type: integer }
  post:
    operationId: createClass
    tags: [Academic Structure]
    summary: Create a new class
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name]
            properties:
              name: { type: string }
              display_order: { type: integer }
    responses:
      '201':
        description: Class created

/admin/academic-structure/classes/{classID}/sections:
  get:
    operationId: listSectionsByClass
    tags: [Academic Structure]
    summary: List sections for a class
    parameters:
      - name: classID
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Section list
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  name: { type: string, example: "A" }
                  student_count: { type: integer }
  post:
    operationId: createSection
    tags: [Academic Structure]
    summary: Create a section in a class
    parameters:
      - name: classID
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name]
            properties:
              name: { type: string, example: "B" }
    responses:
      '201':
        description: Section created

/admin/academic-structure/subjects:
  get:
    operationId: listSubjects
    tags: [Academic Structure]
    summary: List all subjects
    responses:
      '200':
        description: Subject list
  post:
    operationId: createSubject
    tags: [Academic Structure]
    summary: Create a subject
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name, code]
            properties:
              name: { type: string, example: "Mathematics" }
              code: { type: string, example: "MATH" }
    responses:
      '201':
        description: Subject created

# ─── Student 360 ────────────────────────────────────
/admin/students/{id}/360:
  get:
    operationId: getStudent360
    tags: [Student 360]
    summary: Get holistic student view
    description: |
      Returns a comprehensive 360° view of a student including academic
      performance, attendance trends, behavioral records, health info,
      and financial standing — all in one response.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Full student 360 data

/admin/students/{id}/360/behavior:
  get:
    operationId: listBehavioralLogs
    tags: [Student 360]
    summary: List behavioral logs for a student
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Behavioral log entries
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  type: { type: string, enum: [positive, negative, neutral] }
                  description: { type: string }
                  date: { type: string, format: date }
                  recorded_by: { type: string }
  post:
    operationId: addBehavioralLog
    tags: [Student 360]
    summary: Add a behavioral log entry
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [type, description]
            properties:
              type: { type: string, enum: [positive, negative, neutral] }
              description: { type: string }
              date: { type: string, format: date }
    responses:
      '201':
        description: Log entry added

/admin/students/{id}/360/health:
  get:
    operationId: getHealthRecord
    tags: [Student 360]
    summary: Get student health record
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Health record
        content:
          application/json:
            schema:
              type: object
              properties:
                blood_group: { type: string, example: "B+" }
                allergies: { type: string }
                medical_conditions: { type: string }
                emergency_contact: { type: string }
  post:
    operationId: upsertHealthRecord
    tags: [Student 360]
    summary: Create/update health record
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              blood_group: { type: string }
              allergies: { type: string }
              medical_conditions: { type: string }
              emergency_contact: { type: string }
    responses:
      '200':
        description: Health record saved

/admin/students/{id}/360/documents:
  get:
    operationId: listStudentDocuments
    tags: [Student 360]
    summary: List student documents
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Document list
  post:
    operationId: uploadStudentDocument
    tags: [Student 360]
    summary: Upload student document
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              file: { type: string, format: binary }
              type: { type: string, description: "Document type (aadhar, birth_certificate, etc.)" }
    responses:
      '201':
        description: Document uploaded

/admin/students/{id}/360/export:
  get:
    operationId: exportStudentPortfolioPdf
    tags: [Student 360]
    summary: Export student portfolio as PDF
    description: Generates and downloads a comprehensive PDF portfolio for the student.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: PDF file download
        content:
          application/pdf:
            schema:
              type: string
              format: binary

# ─── Confidential Notes ─────────────
/admin/students/{id}/confidential-notes:
  get:
    operationId: listConfidentialNotes
    tags: [Confidential Notes]
    summary: List confidential notes for a student
    description: Returns notes only visible to authorized staff (not shared with parents/students).
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Notes list
  post:
    operationId: addConfidentialNote
    tags: [Confidential Notes]
    summary: Add a confidential note
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [content]
            properties:
              content: { type: string, description: Note content (Markdown supported) }
    responses:
      '201':
        description: Note added

/admin/students/{id}/confidential-notes/{noteId}:
  delete:
    operationId: deleteConfidentialNote
    tags: [Confidential Notes]
    summary: Delete a confidential note
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
      - name: noteId
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Note deleted

# ─── Custom Fields ───────────────────
/admin/custom-fields/definitions:
  get:
    operationId: listCustomFieldDefinitions
    tags: [Custom Fields]
    summary: List custom field definitions
    description: Returns all custom field definitions configured for the tenant.
    responses:
      '200':
        description: Definitions list
  post:
    operationId: createCustomFieldDefinition
    tags: [Custom Fields]
    summary: Create a custom field definition
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name, field_type, entity_type]
            properties:
              name: { type: string, example: "Father's Occupation" }
              field_type: { type: string, enum: [text, number, date, select, checkbox, textarea] }
              entity_type: { type: string, description: "Entity this field applies to", example: "student" }
              options: { type: array, items: { type: string }, description: "For select/checkbox types" }
              is_required: { type: boolean, default: false }
    responses:
      '201':
        description: Definition created

/admin/custom-fields/definitions/{id}:
  put:
    operationId: updateCustomFieldDefinition
    tags: [Custom Fields]
    summary: Update a custom field definition
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              options: { type: array, items: { type: string } }
              is_required: { type: boolean }
    responses:
      '200':
        description: Updated
  delete:
    operationId: deleteCustomFieldDefinition
    tags: [Custom Fields]
    summary: Delete a custom field definition
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Deleted

/admin/custom-fields/values/{entityType}/{entityId}:
  get:
    operationId: getCustomFieldValues
    tags: [Custom Fields]
    summary: Get custom field values for an entity
    parameters:
      - name: entityType
        in: path
        required: true
        schema: { type: string }
        description: Entity type (e.g. "student", "employee")
      - name: entityId
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Key-value map of custom field values

/admin/custom-fields/values/{entityId}:
  put:
    operationId: setCustomFieldValues
    tags: [Custom Fields]
    summary: Set custom field values for an entity
    parameters:
      - name: entityId
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            additionalProperties: true
            description: Map of field_id to value
    responses:
      '200':
        description: Values saved

# ─── Houses ──────────────────────────
/admin/houses:
  get:
    operationId: listHouses
    tags: [Houses]
    summary: List student houses
    responses:
      '200':
        description: House list
  post:
    operationId: createHouse
    tags: [Houses]
    summary: Create a new house
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name]
            properties:
              name: { type: string, example: "Blue Eagles" }
              color: { type: string, example: "#1E88E5" }
    responses:
      '201':
        description: Created

/admin/houses/{id}:
  put:
    operationId: updateHouse
    tags: [Houses]
    summary: Update a house
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              color: { type: string }
    responses:
      '200':
        description: Updated
  delete:
    operationId: deleteHouse
    tags: [Houses]
    summary: Delete a house
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Deleted

/admin/houses/assign/{studentId}:
  post:
    operationId: assignStudentHouse
    tags: [Houses]
    summary: Assign a student to a house
    parameters:
      - name: studentId
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [house_id]
            properties:
              house_id: { type: string, format: uuid }
    responses:
      '200':
        description: Student assigned to house

# ─── School Profile ──────────────────
/admin/school-profile:
  get:
    operationId: getSchoolProfile
    tags: [School Profile]
    summary: Get school profile
    responses:
      '200':
        description: School profile settings
  put:
    operationId: updateSchoolProfile
    tags: [School Profile]
    summary: Update school profile
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              address: { type: string }
              phone: { type: string }
              email: { type: string, format: email }
              logo_url: { type: string, format: uri }
              website: { type: string, format: uri }
    responses:
      '200':
        description: Profile updated

/admin/import-jobs:
  get:
    operationId: listImportJobs
    tags: [Students]
    summary: List import jobs
    description: Returns the status and results of all CSV/Excel import jobs.
    responses:
      '200':
        description: Import job list

# ─── ID Cards ────────────────────────
/admin/id-cards/templates:
  get:
    operationId: listIdCardTemplates
    tags: [ID Cards]
    summary: List ID card templates
    responses:
      '200':
        description: Template list
  post:
    operationId: createIdCardTemplate
    tags: [ID Cards]
    summary: Create an ID card template
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name, layout]
            properties:
              name: { type: string }
              layout: { type: object, description: JSON layout definition }
    responses:
      '201':
        description: Template created

/admin/id-cards/templates/{id}:
  delete:
    operationId: deleteIdCardTemplate
    tags: [ID Cards]
    summary: Delete an ID card template
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Deleted

# ─── Hostel ──────────────────────────
/admin/hostel/buildings:
  get:
    operationId: listHostelBuildings
    tags: [Hostel]
    summary: List hostel buildings
    responses:
      '200':
        description: Building list
  post:
    operationId: createHostelBuilding
    tags: [Hostel]
    summary: Create a hostel building
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [name]
            properties:
              name: { type: string }
              capacity: { type: integer }
              type: { type: string, enum: [boys, girls, mixed] }
    responses:
      '201':
        description: Building created

/admin/hostel/buildings/{buildingId}/rooms:
  get:
    operationId: listHostelRooms
    tags: [Hostel]
    summary: List rooms in a building
    parameters:
      - name: buildingId
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Room list
  post:
    operationId: createHostelRoom
    tags: [Hostel]
    summary: Create a room
    parameters:
      - name: buildingId
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [room_number]
            properties:
              room_number: { type: string }
              capacity: { type: integer }
              floor: { type: integer }
    responses:
      '201':
        description: Room created

/admin/hostel/allocations:
  get:
    operationId: listHostelAllocations
    tags: [Hostel]
    summary: List hostel allocations
    responses:
      '200':
        description: Allocation list
  post:
    operationId: allocateHostelRoom
    tags: [Hostel]
    summary: Allocate a room to a student
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [student_id, room_id]
            properties:
              student_id: { type: string, format: uuid }
              room_id: { type: string, format: uuid }
    responses:
      '201':
        description: Room allocated

/admin/hostel/allocations/{id}/vacate:
  post:
    operationId: vacateHostelRoom
    tags: [Hostel]
    summary: Vacate a room allocation
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
        description: Allocation ID
    responses:
      '200':
        description: Room vacated

# ─── Promotion ───────────────────────
/admin/promotion/rules:
  post:
    operationId: createPromotionRule
    tags: [Promotion]
    summary: Create a promotion rule
    description: Defines criteria for automatically promoting students to the next class.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              from_class_id: { type: string, format: uuid }
              to_class_id: { type: string, format: uuid }
              criteria: { type: object, description: "Promotion criteria (min attendance, min marks, etc.)" }
    responses:
      '201':
        description: Rule created

/admin/promotion/apply:
  post:
    operationId: applyPromotion
    tags: [Promotion]
    summary: Execute student promotion
    description: |
      Applies the specified promotion rule to a section, moving qualifying
      students to the next class. Returns counts of promoted and failed students.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [rule_id, section_id]
            properties:
              rule_id: { type: string, format: uuid }
              section_id: { type: string, format: uuid }
    responses:
      '200':
        description: Promotion results
        content:
          application/json:
            schema:
              type: object
              properties:
                promoted: { type: integer }
                failed: { type: integer }
                skipped: { type: integer }

# ─── Student Remarks ────────────────────────────────
/admin/remarks:
  post:
    operationId: createStudentRemark
    tags: [Student Remarks]
    summary: Create a new student remark
    description: Adds a behavioral or academic remark for a student.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [student_id, category, remark_text]
            properties:
              student_id: { type: string, format: uuid }
              category: { type: string, enum: [academic, behavior, attendance, other] }
              remark_text: { type: string }
              requires_ack: { type: boolean, default: false }
    responses:
      '201':
        description: Remark created
        content:
          application/json:
            schema:
              type: object
              properties:
                id: { type: string, format: uuid }

/admin/students/{studentID}/remarks:
  get:
    operationId: listStudentRemarks
    tags: [Student Remarks]
    summary: List remarks for a specific student
    parameters:
      - name: studentID
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: List of remarks
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id: { type: string, format: uuid }
                  category: { type: string }
                  remark_text: { type: string }
                  posted_by_name: { type: string }
                  created_at: { type: string, format: date-time }
                  is_acknowledged: { type: boolean }

/admin/remarks/{id}/acknowledge:
  post:
    operationId: acknowledgeStudentRemark
    tags: [Student Remarks]
    summary: Acknowledge a student remark
    description: Marks a remark as acknowledged by the parent or admin.
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
        description: Remark ID
    responses:
      '200':
        description: Remark acknowledged
